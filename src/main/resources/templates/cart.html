<!DOCTYPE html>
<html
		xmlns:th="http://www.thymeleaf.org"
		xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
		layout:decorate="~{layout}">
<head>
	<meta charset="UTF-8">
	<title>Shopping Cart</title>
</head>
<body>
<div layout:fragment="content">
	<section class="header_text sub">
		<h4><span>Shopping Cart</span></h4>
	</section>

	<section class="main-content">
		<div class="row">
			<!-- ✅ span12 ilə səhifənin tam eni istifadə olunur -->
			<div class="span12">
				<h4 class="title"><span class="text"><strong>Your</strong> Cart</span></h4>
				<table class="table table-striped">
					<thead>
					<tr>
						<th>Remove</th>
						<th>Image</th>
						<th>Product Name</th>
						<th>Quantity</th>
						<th>Size</th>
						<th>Unit Price</th>
						<th>Total</th>
					</tr>
					</thead>
					<tbody>
					<tr th:each="basket : ${baskets}">
						<td>
							<a th:href="@{'/removeFromCart/' + ${basket.id}}"
							   class="btn btn-danger btn-sm"
							   title="Remove from cart"
							   style="padding: 2px 6px; font-size: 14px; line-height: 1;">
								&times;
							</a>
						</td>

						<td>
							<a th:href="@{'/product/product-detail/' + ${basket.product.id}}">
								<img alt="Product Image" th:src="${basket.product.photoUrl}"
									 style="max-width: 120px; max-height: 120px; object-fit: contain;">
							</a>
						</td>

						<td th:text="${basket.product.name}">Fusce id molestie massa</td>

						<td th:text="${basket.quantity}"><input type="text" placeholder="1" class="input-mini"></td>
						<td th:text="${basket.size}">Fusce id molestie massa</td>

						<!-- ✅ Endirimli qiymət göstərilməsi -->
						<td>
							<span th:if="${basket.product.discountPrice > 0}">
								<span style="text-decoration: line-through; color: #888;"
									  th:text="${#numbers.formatDecimal(basket.product.price, 0, 2) + ' $'}"></span>
								<br>
								<span style="color: red;"
									  th:text="${#numbers.formatDecimal(basket.product.resultPrice, 0, 2) + ' $'}"></span>
							</span>
								<span th:if="${basket.product.discountPrice == 0 or basket.product.discountPrice == null}">
								<span th:text="${#numbers.formatDecimal(basket.product.price, 0, 2) + ' $'}"></span>
							</span>
						</td>

						<td th:text="${#numbers.formatDecimal(basket.totalPrice, 0, 2) + ' $'}"></td>


					<tr>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td><strong th:text="${#numbers.formatDecimal(subTotal, 0, 2) + ' $'}" >$3,600.00</strong></td>
					</tr>
					</tbody>
				</table>

				<h4>What would you like to do next?</h4>
				<p>Choose if you have reward points you want to use.</p>
				

				<div class="reward-point-box" style="margin-top: 20px;" th:if="${rewardPoint > 0}">
					<p><strong>You can use your reward points</strong></p>

					<!-- İstifadə edilmiş və qalan point məlumatı -->
					<p>
						You have used
						<strong th:text="${usedRewardPoint}">0</strong>
						points. You can still use up to
						<strong th:text="${rewardPoint}">0</strong>.
					</p>

					<form id="rewardPointForm" th:action="@{/cart/use-reward}" method="post">
						<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
						<label for="rewardPointInput">
							Enter points (max: <span id="maxRewardPoint" th:text="${rewardPoint}">0</span>):
						</label>

						<input type="number"
							   id="rewardPointInput"
							   name="rewardPoint"
							   class="form-control"
							   th:attr="max=${rewardPoint}"
							   min="1"
							   placeholder="Enter reward point"
							   style="width: 200px; display: inline-block; margin-right: 10px; background-color: #f3f3f3;"
							   required />

						<button type="submit" class="btn btn-success">Use</button>
					</form>
				</div>


				<div th:if="${rewardPoint == 0}">
					<p style="color: gray;">You have already used your reward points.</p>
				</div>

				<hr>

				<p class="cart-total right">
					<strong>Sub-Total</strong>: $<span th:text="${#numbers.formatDecimal(resultSubTotal, 0, 2)}">0.00</span><br>

					<strong>Eco Tax (-2.00)</strong>: $2.00<br>
					<strong>VAT (-3.00)</strong>: $3.00<br>
					<strong>Total</strong>:
					<span th:text="${#numbers.formatDecimal(total, 0, 2)}">
    0.00
</span><br>
				</p>

				<hr/>

				<p class="buttons center">
					<a href="/" class="btn">Continue</a>
					<a th:href="@{/checkout}" class="btn btn-inverse">Checkout</a>
				</p>
			</div>
		</div>
	</section>
</div>
</body>
</html>
